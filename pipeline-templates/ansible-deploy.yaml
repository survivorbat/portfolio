parameters:
  - name: ansibleDockerImage
    type: string
    default: 'survivorbat/ansible:v0.4'
  - name: rootDirectory
    type: string
  - name: playbookFileName
    type: string
    default: site.yaml
  - name: ansibleEnvironment
    type: object
    default: {}

steps:
  - bash: |
      docker pull ${{ parameters.ansibleDockerImage }}
    displayName: Pull ${{ parameters.ansibleDockerImage }}
  - bash: |
      echo "docker run --rm -v ${{ parameters.rootDirectory }}:/app ${{ parameters.ansibleDockerImage }} ansible-lint ${{ parameters.playbookFileName }}"
      docker run --rm -v ${{ parameters.rootDirectory }}:/app ${{ parameters.ansibleDockerImage }} ansible-lint ${{ parameters.playbookFileName }}
    env: ${{ parameters.ansibleEnvironment }}
    displayName: Run ansible-lint

  - bash: |
      echo "docker run --rm -v ${{ parameters.rootDirectory }}:/app ${{ parameters.ansibleDockerImage }} ansible-playbook ${{ parameters.playbookFileName }}"
      docker run --rm -v ${{ parameters.rootDirectory }}:/app ${{ parameters.ansibleDockerImage }} ansible-playbook ${{ parameters.playbookFileName }}
    env: ${{ parameters.ansibleEnvironment }}
    displayName: Run ansible
